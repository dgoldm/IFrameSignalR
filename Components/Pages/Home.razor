@page "/"

@using Microsoft.AspNetCore.SignalR
@using Microsoft.AspNetCore.SignalR.Client
@using IFrameSignalR.Hubs

@inject IHubContext<AppHub> Hub
@inject NavigationManager NavigationManager


<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.

<h4>@currentCount</h4>

<iframe src="@("/iframe/" + hubConnection!.ConnectionId)" width="480" height="480">
</iframe>

@code {
	private HubConnection? hubConnection;
	private int currentCount = 0;

	protected override async Task OnInitializedAsync()
	{
		await base.OnInitializedAsync();
		hubConnection = new HubConnectionBuilder().WithUrl(NavigationManager.BaseUri + nameof(AppHub)).Build();
		await hubConnection.StartAsync();

		hubConnection.On("clicked", async () => {
			currentCount++;
			await InvokeAsync(StateHasChanged);
		});
	}
}